# 图片审核平台使用说明

## 新增功能

本次更新为图片审核平台增加了以下功能：

### 1. 自动识别图片尺寸信息
- ✅ **宽度**：自动识别图片的宽度（单位：像素）
- ✅ **高度**：自动识别图片的高度（单位：像素）
- ✅ **宽高比**：自动计算图片的宽高比（保留2位小数）
- ✅ **文件大小**：自动获取图片文件大小（显示为B/KB/MB）

这些信息会在图片加载完成后自动显示在每张图片卡片的信息区域。

### 2. 图片尺寸筛选功能
在筛选区域新增了4个专门的图片尺寸筛选项：

#### 筛选项说明

| 筛选项 | 单位 | 说明 |
|--------|------|------|
| 宽度(px) | 像素 | 筛选图片的宽度 |
| 高度(px) | 像素 | 筛选图片的高度 |
| 宽高比 | 无 | 筛选图片的宽高比（宽度÷高度） |
| 文件大小(KB) | KB | 筛选图片的文件大小 |

#### 筛选语法

支持以下筛选语法：

1. **大于**：`>数值`
   - 示例：`>1000` 表示大于1000

2. **小于**：`<数值`
   - 示例：`<500` 表示小于500

3. **大于等于**：`>=数值`
   - 示例：`>=800` 表示大于等于800

4. **小于等于**：`<=数值`
   - 示例：`<=1920` 表示小于等于1920

5. **等于**：`数值`
   - 示例：`1920` 表示等于1920

6. **范围**：`数值1-数值2`
   - 示例：`500-2000` 表示在500到2000之间

## 实用筛选场景

### 场景1：筛选横向图片
- **宽高比** 输入：`>1.3`
- 说明：宽高比大于1.3的图片是横向图片

### 场景2：筛选竖向图片
- **宽高比** 输入：`<0.8`
- 说明：宽高比小于0.8的图片是竖向图片

### 场景3：筛选高清大图
- **宽度** 输入：`>1920`
- **高度** 输入：`>1080`
- 说明：同时满足宽度大于1920px和高度大于1080px

### 场景4：筛选小图片
- **文件大小** 输入：`<200`
- 说明：文件大小小于200KB的图片

### 场景5：筛选标准尺寸
- **宽度** 输入：`1080-1920`
- **高度** 输入：`720-1080`
- 说明：宽度在1080-1920之间，高度在720-1080之间

### 场景6：筛选方形图片
- **宽高比** 输入：`0.9-1.1`
- 说明：宽高比接近1的图片（近似正方形）

### 场景7：筛选16:9图片
- **宽高比** 输入：`1.7-1.8`
- 说明：宽高比在1.7-1.8之间（16÷9≈1.78）

### 场景8：筛选超大文件
- **文件大小** 输入：`>1000`
- 说明：文件大小大于1MB（1000KB）的图片

## 技术细节

### 图片元数据获取流程
1. 当图片加载完成后，系统自动触发元数据获取
2. 使用 `Image` 对象的 `naturalWidth` 和 `naturalHeight` 获取原始尺寸
3. 使用 `fetch` 的 HEAD 请求获取文件大小（Content-Length）
4. 计算宽高比并格式化显示
5. 将元数据缓存到内存中，避免重复请求

### 性能优化
- **缓存机制**：每个图片的元数据只获取一次，后续从缓存中读取
- **异步加载**：元数据获取不阻塞页面渲染
- **批量处理**：支持大量图片的高效筛选

### 兼容性说明
- **宽度/高度**：所有图片都能获取（基于 Image 对象）
- **文件大小**：需要服务器支持 CORS 和 Content-Length 响应头
  - 如果图片跨域且服务器不支持 CORS，文件大小可能显示为"未知"
  - 本地测试或同域图片不受影响

## 测试步骤

### 1. 启动本地服务器
```bash
cd /Users/tong.he/Documents/喜马拉雅/网文小说服务/一期确认/image-review-platform
python3 -m http.server 8765
```

### 2. 打开浏览器
访问：http://localhost:8765/index.html

### 3. 导入测试CSV
使用提供的 `test-images.csv` 文件进行测试

### 4. 观察图片信息
等待图片加载完成后，每张图片卡片上会显示：
- 宽度
- 高度
- 宽高比
- 文件大小

### 5. 测试筛选功能
在筛选区域尝试不同的筛选条件，验证筛选结果是否正确

## 常见问题

### Q1: 为什么有些图片的文件大小显示为"未知"？
**A:** 可能是因为：
- 图片跨域且服务器不支持 CORS
- 服务器没有返回 Content-Length 响应头
- 网络请求失败

### Q2: 图片尺寸信息什么时候显示？
**A:** 图片加载完成后会自动显示。如果网络较慢，可能需要等待几秒钟。

### Q3: 筛选条件支持组合吗？
**A:** 是的！所有筛选条件都支持组合使用，系统会同时应用所有筛选条件。

### Q4: 宽高比是如何计算的？
**A:** 宽高比 = 宽度 ÷ 高度，保留2位小数。例如：1920÷1080≈1.78

### Q5: 刷新页面后图片元数据会丢失吗？
**A:** 是的。图片元数据保存在内存中，刷新页面后需要重新加载图片才能获取。

## 更新日志

### v1.1.0 (2026-01-13)
- ✅ 新增图片宽度自动识别
- ✅ 新增图片高度自动识别
- ✅ 新增图片宽高比自动计算
- ✅ 新增图片文件大小自动获取
- ✅ 新增图片尺寸筛选功能（支持范围筛选）
- ✅ 新增元数据缓存机制
- ✅ 优化筛选区域布局
- ✅ 更新 README 文档

## 反馈与建议

如有问题或建议，请及时反馈。
